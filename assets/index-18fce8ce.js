var ne=Object.defineProperty;var se=(r,t,e)=>t in r?ne(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var d=(r,t,e)=>(se(r,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class K{constructor(t,e){d(this,"boardPiece");d(this,"label");this.boardPiece=t,this.label=e}}const D=10**9+7,U=-D;function ie(r,t,e){return(r.x-t)*(r.x-t)<=e*e}function X(r){for(let t=0;t<c.COLUMNS;t++)if(ie(r,3*c.PIECE_RADIUS*t+c.MASK_X_BEGIN+2*c.PIECE_RADIUS,c.PIECE_RADIUS))return t;return-1}function T(r){return r[Math.floor(Math.random()*r.length)]}function Q(r){const t=[];for(let e=0;e<r.length;e++)t[e]=r[e].slice();return t}function q(r,t,e){const i=Q(r);if(i[0][e]!==f.EMPTY||e<0||e>=c.COLUMNS)return{success:!1,map:i};let s=!1,n=0;for(let o=0;o<c.ROWS-1;o++)if(i[o+1][e]!==f.EMPTY){s=!0,n=o;break}return s||(n=c.ROWS-1),i[n][e]=t,{success:!0,map:i}}var f=(r=>(r.EMPTY=" ",r.PLAYER_1="ðŸ”´",r.PLAYER_2="ðŸ”µ",r.DRAW="D",r))(f||{});const l=class l{constructor(){d(this,"map");d(this,"winnerBoardPiece");this.map=[],this.winnerBoardPiece=" ",this.initConstants(),this.reset()}reset(){this.map=[];for(let t=0;t<l.ROWS;t++){this.map.push([]);for(let e=0;e<l.COLUMNS;e++)this.map[t].push(" ")}this.winnerBoardPiece=" "}initConstants(){l.CANVAS_HEIGHT=l.SCALE*480,l.CANVAS_WIDTH=l.SCALE*640,l.PIECE_RADIUS=l.SCALE*25,l.MASK_X_BEGIN=Math.max(0,l.CANVAS_WIDTH-(3*l.COLUMNS+1)*l.PIECE_RADIUS)/2,l.MASK_Y_BEGIN=Math.max(0,l.CANVAS_HEIGHT-(3*l.ROWS+1)*l.PIECE_RADIUS)/2,l.MESSAGE_WIDTH=l.SCALE*400,l.MESSAGE_X_BEGIN=(l.CANVAS_WIDTH-l.MESSAGE_WIDTH)/2,l.MESSAGE_Y_BEGIN=l.SCALE*20}async applyPlayerAction(t,e){const{success:i,map:s}=q(this.map,t.boardPiece,e);return this.map=s,i}debug(){console.log(this.map.map(t=>t.join(" ")).join(`
`))}getWinner(){if(this.winnerBoardPiece!==" ")return this.winnerBoardPiece;const t=[[0,-1],[0,1],[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1]],e=(s,n,o,a,u)=>u>=4?!0:s<0||n<0||s>=l.ROWS||n>=l.COLUMNS||this.map[s][n]!==o?!1:e(s+a[0],n+a[1],o,a,u+1);let i=0;for(let s=0;s<l.ROWS;s++)for(let n=0;n<l.COLUMNS;n++){const o=this.map[s][n];if(o!==" "){for(let a=0;a<t.length;a++)if(e(s+t[a][0],n+t[a][1],o,t[a],1))return this.winnerBoardPiece=o}else i++}return i===0?this.winnerBoardPiece="D":" "}getPlayerColor(t){switch(t){case"ðŸ”´":return l.PLAYER_1_COLOR;case"ðŸ”µ":return l.PLAYER_2_COLOR;default:return"transparent"}}};d(l,"ROWS",6),d(l,"COLUMNS",7),d(l,"PLAYER_1_COLOR","#ef453b"),d(l,"PLAYER_2_COLOR","#0059ff"),d(l,"PIECE_STROKE_STYLE","black"),d(l,"MASK_COLOR","#d8d8d8"),d(l,"CANVAS_HEIGHT"),d(l,"CANVAS_WIDTH"),d(l,"PIECE_RADIUS"),d(l,"MASK_X_BEGIN"),d(l,"MASK_Y_BEGIN"),d(l,"MESSAGE_WIDTH"),d(l,"MESSAGE_X_BEGIN"),d(l,"MESSAGE_Y_BEGIN"),d(l,"SCALE");let c=l;const G=class G extends K{constructor(e,i){super(e,i);d(this,"ownBoardPieceValue");d(this,"enemyBoardPiece");this.ownBoardPieceValue=this.getBoardPieceValue(e),this.enemyBoardPiece=e===f.PLAYER_1?f.PLAYER_2:f.PLAYER_1}getBoardPieceValue(e){return e===f.EMPTY?0:e===this.boardPiece?1:-1}getStateValue(e){let i=f.EMPTY,s=0;for(let n=0;n<c.ROWS;n++)for(let o=0;o<c.COLUMNS;o++){let a=0,u=0,m=0,E=0;for(let h=0;h<=3;h++)o+h<c.COLUMNS&&(a+=this.getBoardPieceValue(e[n][o+h])),n+h<c.ROWS&&(u+=this.getBoardPieceValue(e[n+h][o])),n+h<c.ROWS&&o+h<c.COLUMNS&&(m+=this.getBoardPieceValue(e[n+h][o+h])),n-h>=0&&o+h<7&&(E+=this.getBoardPieceValue(e[n-h][o+h]));s+=a*a*a,s+=u*u*u,s+=m*m*m,s+=E*E*E,Math.abs(a)===4?i=a>0?this.boardPiece:this.enemyBoardPiece:Math.abs(u)===4?i=u>0?this.boardPiece:this.enemyBoardPiece:Math.abs(m)===4?i=m>0?this.boardPiece:this.enemyBoardPiece:Math.abs(E)===4&&(i=E>0?this.boardPiece:this.enemyBoardPiece)}return{winnerBoardPiece:i,chain:s}}transformValues(e,i,s){const n=i===this.boardPiece,o=i===this.enemyBoardPiece;return e-=s*s,n?e=D-100-s*s:o&&(e=U+100+s*s),e}getMove(e,i,s,n){const o=this.getStateValue(e),a=o.winnerBoardPiece===this.boardPiece,u=o.winnerBoardPiece===this.enemyBoardPiece;return i>=G.MAX_DEPTH||a||u?{value:this.transformValues(o.chain,o.winnerBoardPiece,i)*this.ownBoardPieceValue,move:-1}:i%2===0?this.minState(e,i+1,s,n):this.maxState(e,i+1,s,n)}maxState(e,i,s,n){let o=U,a=[];for(let u=0;u<c.COLUMNS;u++){const{success:m,map:E}=q(e,this.boardPiece,u);if(!m)continue;const{value:h}=this.getMove(E,i,s,n);if(h>o?(o=h,a=[u]):h===o&&a.push(u),o>n)return{value:o,move:T(a)};s=Math.max(s,o)}return{value:o,move:T(a)}}minState(e,i,s,n){let o=D,a=[];for(let u=0;u<c.COLUMNS;u++){const{success:m,map:E}=q(e,this.enemyBoardPiece,u);if(!m)continue;const{value:h}=this.getMove(E,i,s,n);if(h<o?(o=h,a=[u]):h===o&&a.push(u),o<s)return{value:o,move:T(a)};n=Math.min(n,o)}return{value:o,move:T(a)}}async getAction(e){const i=Q(e.map),s=this.maxState(i,0,U,D);return console.log(`AI ${this.boardPiece} choose column ${s.move} with value of ${s.value}`),s.move}};d(G,"MAX_DEPTH",4);let _=G;class b extends K{constructor(e,i){super(e,i);d(this,"clickPromiseResolver");this.clickPromiseResolver=null}doAction(e){this.clickPromiseResolver&&0<=e&&e<c.COLUMNS&&this.clickPromiseResolver(e)}getAction(e){return new Promise(i=>this.clickPromiseResolver=i)}}class $ extends K{constructor(e,i){super(e,i);d(this,"actionPromiseResolver");this.actionPromiseResolver=null}doAction(e){this.actionPromiseResolver&&0<=e&&e<c.COLUMNS&&this.actionPromiseResolver(e)}getAction(e){return new Promise(i=>this.actionPromiseResolver=i)}}class z{constructor(t,e){d(this,"board");d(this,"players");d(this,"currentPlayerId");d(this,"isMoveAllowed",!1);d(this,"isGameWon",!1);d(this,"isGameEnded",!1);this.board=e,this.players=t,this.currentPlayerId=0,this.reset()}reset(){this.isMoveAllowed=!1,this.isGameWon=!1,this.board.reset()}end(){this.reset(),this.isGameEnded=!0}async start(){for(this.isMoveAllowed=!0;!this.isGameWon;){if(this.isGameEnded)return;await this.move();const t=this.board.getWinner();if(t!==f.EMPTY){console.log("[GameBase] Game over: winner is player ",t),this.isGameWon=!0,this.isMoveAllowed=!1,this.announceWinner(t);break}}}async move(){if(this.isGameEnded||!this.isMoveAllowed)return;const t=this.players[this.currentPlayerId];let e=!1;for(;!e;){if(this.isGameEnded)return;this.waitingForMove();const i=await t.getAction(this.board);this.isMoveAllowed=!1,this.beforeMoveApplied(i),e=await this.board.applyPlayerAction(t,i),this.isMoveAllowed=!0,e?this.afterMove(i):console.log("Move not allowed! Try again.")}this.currentPlayerId=this.getNextPlayer()}announceWinner(t){const e={[f.DRAW]:"draw",[f.PLAYER_1]:"Player 1",[f.PLAYER_2]:"Player 2",[f.EMPTY]:"none"}[t];console.log("[GameBase] Game over: winner is ",e,t)}getNextPlayer(){return this.currentPlayerId===0?1:0}}var C=(r=>(r.NEW_PLAYER_CONNECTION_REQUEST="NEW_PLAYER_CONNECTION_REQUEST",r.NEW_PLAYER_CONNECTION_OK="NEW_PLAYER_CONNECTION_OK",r.NEW_MATCH_REQUEST="NEW_MATCH_REQUEST",r.NEW_MATCH_OK="NEW_MATCH_OK",r.GAME_READY="GAME_READY",r.GAME_ENDED="GAME_ENDED",r.GAME_RESET="GAME_RESET",r.CONNECT_MATCH_REQUEST="CONNECT_MATCH_REQUEST",r.CONNECT_MATCH_OK="CONNECT_MATCH_OK",r.CONNECT_MATCH_FAIL="CONNECT_MATCH_FAIL",r.HUNG_UP="HUNG_UP",r.OTHER_PLAYER_HUNGUP="OTHER_PLAYER_HUNGUP",r.MOVE_MAIN="MOVE_MAIN",r.MOVE_SHADOW="MOVE_SHADOW",r))(C||{});function x(r,t){return console.log("[ws] send: ",r,t),JSON.stringify({type:r,payload:t||{}})}function re(r){const t=JSON.parse(r);return console.log("[ws] receive: ",t),t}function oe(){const r=[];let t=!1;function e(){t||(t=!0,window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,66))}function i(){r.forEach(n=>{n()}),t=!1}function s(n){n&&r.push(n)}return{add:n=>{r.length||window.addEventListener("resize",e),s(n)}}}function B(r,{x:t=0,y:e=0,r:i=0,fillStyle:s="",strokeStyle:n=""}){r.save(),r.fillStyle=s,r.strokeStyle=n,r.beginPath(),r.arc(t,e,i,0,2*Math.PI,!1),r.fill(),r.restore()}function ae(r){const t=r.context;t.save(),t.fillStyle=y.MASK_COLOR,t.beginPath();const e=2*y.PIECE_RADIUS,i=3*y.PIECE_RADIUS;for(let s=0;s<y.ROWS;s++)for(let n=0;n<y.COLUMNS;n++)t.arc(i*n+y.MASK_X_BEGIN+e,i*s+y.MASK_Y_BEGIN+e,y.PIECE_RADIUS,0,2*Math.PI),t.rect(i*n+y.MASK_X_BEGIN+2*e,i*s+y.MASK_Y_BEGIN,-2*e,2*e);t.fill(),t.restore()}function H(r){r.context.clearRect(0,0,y.CANVAS_WIDTH,y.CANVAS_HEIGHT)}function W(){let r=null;const t=new Promise(e=>r=e);return r&&window.requestAnimationFrame(r),t}class y extends c{constructor(e){super();d(this,"canvas");d(this,"context");this.canvas=e,this.context=e.getContext("2d"),this.getBoardScale(),this.initConstants(),this.reset(),this.onresize()}getBoardScale(){return window.innerWidth<640?c.SCALE=.5:c.SCALE=1}onresize(){let e=c.SCALE;oe().add(()=>{this.getBoardScale(),e!==c.SCALE&&(e=c.SCALE,this.initConstants(),H(this),this.render())})}reset(){super.reset(),this.canvas&&(H(this),this.render())}initConstants(){if(super.initConstants(),this.canvas){const e=self.devicePixelRatio||1;this.canvas.width=y.CANVAS_WIDTH*e,this.canvas.height=y.CANVAS_HEIGHT*e,this.context.scale(e,e),this.canvas.style.width=y.CANVAS_WIDTH+"px",this.canvas.style.height=y.CANVAS_HEIGHT+"px"}}async animateAction(e,i,s){const n=this.getPlayerColor(s);let o=0;const a=async()=>{H(this),B(this.context,{x:3*c.PIECE_RADIUS*i+c.MASK_X_BEGIN+2*c.PIECE_RADIUS,y:o+c.MASK_Y_BEGIN+2*c.PIECE_RADIUS,r:c.PIECE_RADIUS,fillStyle:n,strokeStyle:c.PIECE_STROKE_STYLE}),this.render(),o+=c.PIECE_RADIUS};for(;e*3*c.PIECE_RADIUS>=o;)await W(),a()}render(){ae(this);for(let e=0;e<c.ROWS;e++)for(let i=0;i<c.COLUMNS;i++)B(this.context,{x:3*c.PIECE_RADIUS*i+c.MASK_X_BEGIN+2*c.PIECE_RADIUS,y:3*c.PIECE_RADIUS*e+c.MASK_Y_BEGIN+2*c.PIECE_RADIUS,r:c.PIECE_RADIUS,fillStyle:this.getPlayerColor(this.map[e][i]),strokeStyle:c.PIECE_STROKE_STYLE})}async applyPlayerAction(e,i){if(this.map[0][i]!==f.EMPTY||i<0||i>=c.COLUMNS)return!1;let s=!1,n=0;for(let o=0;o<c.ROWS-1;o++)if(this.map[o+1][i]!==f.EMPTY){s=!0,n=o;break}return s||(n=c.ROWS-1),await this.animateAction(n,i,e.boardPiece),this.map[n][i]=e.boardPiece,this.debug(),await W(),this.render(),!0}}function w(r=""){const t=document.querySelector(".message-body");if(!t){console.error(".message-body not found");return}const e=document.querySelector(".message-body-content");if(!e){console.error(".message-body-content not found");return}t.hasAttribute("open")&&t.close(),e.innerHTML=r,t.showModal()}const R=document.querySelector(".statusbox"),v=document.querySelector(".statusbox-body-game"),Y=document.querySelector(".statusbox-body-connection"),N=document.querySelector(".statusbox-body-player");class F extends z{constructor(t,e){super(t,e)}beforeMoveApplied(){if(v){const t=this.players[this.currentPlayerId];v.textContent=`Dropping ${t.boardPiece} disc`}}waitingForMove(){if(!(!this.isMoveAllowed||this.isGameWon)&&(v&&(v.textContent="Wating for move"),N)){const t=this.players[this.currentPlayerId];N.textContent=`${t.label} ${t.boardPiece}`}}afterMove(){}announceWinner(t){if(super.announceWinner(t),t===f.EMPTY)return;let e,i="<h1>Thank you for playing.</h1>";t===f.DRAW?i+="It's a draw":(e=this.players.find(s=>s.boardPiece===t),e?i+=`${e.label} ${e.boardPiece} won`:i+=`Player ${t} won`),i+=".<br />After dismissing this message, click the board to reset game.",w(i),v&&(v.textContent="Game over"),N&&(N.textContent=t===f.DRAW?"It's a draw":e?`${e.label} ${e.boardPiece} won`:`Player ${t===f.PLAYER_1?"1 ðŸ”´":"2 ðŸ”µ"} won`)}}function j(r,t,e){const i=document.querySelector("canvas");if(!i){console.error("Canvas DOM is null");return}const s=new y(i),n=new r([t,e],s);R==null||R.classList.remove("hidden"),Y==null||Y.classList.add("hidden"),n.start(),v&&(v.textContent="Wating for move"),N&&(N.textContent=`${t.label} ${t.boardPiece}`);async function o(a){if(n.isGameWon)n.reset(),await W(),n.start();else{if(!i)return;const u=i.getBoundingClientRect(),m=a.clientX-u.left,E=a.clientY-u.top,h=X({x:m,y:E});n.currentPlayerId===0?t.doAction(h):n.currentPlayerId===1&&e instanceof b&&e.doAction(h)}}return i.addEventListener("click",o),{end:()=>{n.end(),i.removeEventListener("click",o),R==null||R.classList.add("hidden")}}}class ce extends F{}function le(r,t){const e=new b(f.PLAYER_1,r),i=new b(f.PLAYER_2,t);return j(ce,e,i)}class de extends F{}function ue(r){const t=new b(f.PLAYER_1,r),e=new _(f.PLAYER_2,"AI Player");return j(de,t,e)}const V=document.querySelector(".statusbox");document.querySelector(".statusbox-body-game");const k=document.querySelector(".statusbox-body-connection");document.querySelector(".statusbox-body-player");class he extends F{constructor(t,e){super(t,e)}announceWinner(t){super.announceWinner(t)}}function fe(){const r=document.querySelector("canvas");if(!r){console.error("Canvas DOM is null");return}const t=new y(r),e=new _(f.PLAYER_1,"AI Player 1"),i=new _(f.PLAYER_2,"AI Player 2"),s=new he([e,i],t);V==null||V.classList.remove("hidden"),k==null||k.classList.add("hidden"),s.start();async function n(o){s.isGameWon&&(s.reset(),await W(),s.start())}return r.addEventListener("click",n),{end:()=>{s.end(),r.removeEventListener("click",n)}}}var L=(r=>(r[r.FIRST=f.PLAYER_1]="FIRST",r[r.SECOND=f.PLAYER_2]="SECOND",r))(L||{});const g=document.querySelector(".statusbox"),S=document.querySelector(".statusbox-body-game"),p=document.querySelector(".statusbox-body-connection"),I=document.querySelector(".statusbox-body-player"),me={}.C4_SERVER_ENDPOINT?{}.C4_SERVER_ENDPOINT:"wss://c4-server.fly.dev/";class Ee extends z{constructor(e,i,{gameMode:s,playerName:n}){super(e,i);d(this,"connectionPlayerId",null);d(this,"connectionMatchId",null);d(this,"ws",null);d(this,"gameMode");d(this,"playerMain");d(this,"playerShadow");d(this,"initMatch",()=>{this.ws&&this.ws.send(x(C.NEW_MATCH_REQUEST,{playerId:this.connectionPlayerId}))});d(this,"connectToMatch",e=>{this.ws&&this.ws.send(x(C.CONNECT_MATCH_REQUEST,{playerId:this.connectionPlayerId,matchId:e}))});d(this,"messageActionHandler",e=>{var i;switch(e.type){case C.NEW_PLAYER_CONNECTION_OK:if(this.connectionPlayerId=e.payload.playerId,this.gameMode===L.FIRST)this.initMatch();else if(this.gameMode===L.SECOND){const n=new URLSearchParams(location.search).get("matchId");if(!n)return;this.connectToMatch(n)}break;case C.NEW_MATCH_OK:{this.connectionMatchId=e.payload.matchId;const s=`${location.href}?matchId=${this.connectionMatchId}`;console.log("[url] Share this",s),w(`<h1>Share this URL</h1><p>Please share this URL to your friend to start the game: <input type="text" id="copy-box" class="copy-box" readonly value="${s}" /><button type="button" id="copy-button">Copy</button></p>`);const n=document.getElementById("copy-box");n.focus(),n.select(),(i=document.getElementById("copy-button"))==null||i.addEventListener("click",async()=>{let o=!1;if(navigator.clipboard)try{await navigator.clipboard.writeText(s),console.log("Using Clipboard API to write share url into clipboard"),o=!0}catch{}o||(n==null||n.select(),n==null||n.setSelectionRange(0,99999),document.execCommand("copy"),console.log("Using fallback method to write share url into clipboard"))})}break;case C.CONNECT_MATCH_OK:this.connectionMatchId=e.payload.matchId;break;case C.CONNECT_MATCH_FAIL:w("<h1>Error</h1> Failed to connect to match."),p&&(p.textContent="Connection error");break;case C.GAME_READY:{if(this.playerShadow.label=e.payload.otherPlayerName,w(`<h1>Game started</h1> The first piece should be dropped by ${this.isCurrentMoveByCurrentPlayer()?"you":"the other player"}`),S&&(S.textContent="Wating for move"),I){const s=this.players[this.currentPlayerId];I.textContent=`${s.label} ${s.boardPiece} `+(this.isCurrentMoveByCurrentPlayer()?"(you)":"(the other player)")}this.start()}break;case C.MOVE_SHADOW:this.playerShadow.doAction(e.payload.column);break;case C.GAME_ENDED:{const{winnerBoardPiece:s}=e.payload;let n=this.players.find(a=>a.boardPiece===s);const o=s===f.DRAW?"It's a draw":n?`${n.label} ${n.boardPiece} won`:`Player ${s===f.PLAYER_1?"1 ðŸ”´":"2 ðŸ”µ"} won`;w("<h1>Thank you for playing</h1>"+o+"<br />Next game will be started in 10 seconds."),S&&(S.textContent="Game over"),I&&(I.textContent=o)}break;case C.GAME_RESET:this.reset();break;case C.OTHER_PLAYER_HUNGUP:w("<h1>Other player disconnected</h1> Please reload the page to start a new match");break}});d(this,"beforeMoveApplied",()=>{if(S){const e=this.players[this.currentPlayerId];S.textContent=`Dropping ${e.boardPiece} disc`}});d(this,"waitingForMove",()=>{if(S&&(S.textContent="Wating for move"),I){const e=this.players[this.currentPlayerId];I.textContent=`${e.label} ${e.boardPiece} `+(this.isCurrentMoveByCurrentPlayer()?"(you)":"(the other player)")}});d(this,"afterMove",e=>{this.ws&&this.isCurrentMoveByCurrentPlayer()&&this.ws.send(x(C.MOVE_MAIN,{playerId:this.connectionPlayerId,matchId:this.connectionMatchId,column:e}))});this.gameMode=s,s===L.FIRST?(this.playerMain=e[0],this.playerShadow=e[1]):(this.playerMain=e[1],this.playerShadow=e[0]),this.playerMain.label=n,this.initConnection()}end(){super.end(),this.endConnection()}endConnection(){this.ws&&this.ws.close()}initConnection(){console.log("initConnection"),this.connectionPlayerId=null,this.connectionMatchId=null,this.ws&&this.ws.close();const e=()=>{this.isMoveAllowed=!1,p&&(p.textContent="Disconnected from server"),S&&(S.textContent="Game over"),I&&(I.textContent="Disconnected from match")};this.ws=new WebSocket(me),this.ws.addEventListener("message",i=>{this.messageActionHandler(re(i.data))}),this.ws.addEventListener("open",()=>{this.ws&&this.ws.send(x(C.NEW_PLAYER_CONNECTION_REQUEST,{playerName:this.playerMain.label})),p&&(p.textContent="Connected to server"),S&&(S.textContent=""),I&&(I.textContent="")}),this.ws.addEventListener("close",i=>{console.log("[ws] close event",i),e()}),this.ws.addEventListener("error",i=>{console.log("[ws] error event",i),e()})}isCurrentMoveByCurrentPlayer(){return this.gameMode===L.FIRST?this.currentPlayerId===0:this.currentPlayerId===1}announceWinner(e){super.announceWinner(e)}}function ye(r){const t=document.querySelector("canvas");if(!t){console.error("Canvas DOM is null");return}const s=new URLSearchParams(location.search).get("matchId")?L.SECOND:L.FIRST,n=new y(t),o=s===L.FIRST?[new b(f.PLAYER_1,r),new $(f.PLAYER_2,"Other player")]:[new $(f.PLAYER_1,"Other player"),new b(f.PLAYER_2,r)],a=new Ee(o,n,{gameMode:s,playerName:r});g==null||g.classList.remove("hidden"),p==null||p.classList.remove("hidden");async function u(m){if(!a.isGameWon){if(!t)return;const E=t.getBoundingClientRect(),h=m.clientX-E.left,M=m.clientY-E.top,O=X({x:h,y:M});a.playerMain.doAction(O)}}return t.addEventListener("click",u),{end:()=>{a.end(),t.removeEventListener("click",u),g==null||g.classList.add("hidden")}}}document.addEventListener("DOMContentLoaded",()=>{const r=document.querySelector(".section-canvas");if(!r){console.error("Canvas element not found");return}const t=document.querySelector(".init-screen");if(!t){console.error("Mode element not found ");return}new y(r).render();const s=new URLSearchParams(location.search).get("matchId"),n=document.querySelector(".statusbox-button-back"),o=document.querySelector(".game-settings-form");if(!o){console.error(".game-settings-form not found ");return}const a=o.querySelector(".game-settings-player-1-name-label"),u=o.querySelector(".game-settings-player-2-name-label"),m=o.querySelector(".game-settings-player-1-name-input"),E=o.querySelector(".game-settings-player-2-name-input");let h=null;n==null||n.classList.add("hidden"),t.showModal();let M=s?"online-human":"offline-ai";O(),n==null||n.addEventListener("click",()=>{h&&h.end&&h.end(),n==null||n.classList.add("hidden"),t.showModal()}),t.addEventListener("cancel",A=>{A.preventDefault()}),t.addEventListener("close",A=>{const P=new FormData(o),Z=P.get("mode"),ee=P.get("player-1-name"),te=P.get("player-2-name");J(Z,[ee,te])}),o.addEventListener("input",A=>{M=new FormData(o).get("mode"),O()});function O(){if(s){for(let A of o.querySelectorAll(".game-settings-mode-input")){const P=A;P.readOnly=!0,P.value==="online-human"?P.checked=!0:P.checked=!1}u.textContent="Your name:",m.disabled=!0,E.disabled=!1,a.classList.add("hidden"),m.classList.add("hidden"),u.classList.remove("hidden"),E.classList.remove("hidden")}else M==="offline-human"?(a.textContent="First player's name:",u.textContent="Second player's name:",a.classList.remove("hidden"),m.classList.remove("hidden"),u.classList.remove("hidden"),E.classList.remove("hidden"),m.disabled=!1,E.disabled=!1):M==="offline-ai"?(a.textContent="Player's name:",u.textContent="Player's name:",a.classList.remove("hidden"),m.classList.remove("hidden"),u.classList.add("hidden"),E.classList.add("hidden"),m.disabled=!1,E.disabled=!0):M==="online-human"?(a.textContent="Your name:",u.textContent="Other player's name:",a.classList.remove("hidden"),m.classList.remove("hidden"),u.classList.add("hidden"),E.classList.add("hidden"),m.disabled=!1,E.disabled=!0):M==="ai-vs-ai"&&(a.textContent="Player's name:",u.textContent="Player's name:",a.classList.add("hidden"),m.classList.add("hidden"),u.classList.add("hidden"),E.classList.add("hidden"),m.disabled=!0,E.disabled=!0)}function J(A,P){console.log("initGame chosenMode:",A),n==null||n.classList.remove("hidden"),A==="offline-human"?h=le(P[0]||"Player 1",P[1]||"Player 2"):A==="offline-ai"?h=ue(P[0]||"Player 1"):A==="online-human"?h=ye(s?P[1]||"Player 2":P[0]||"Player 1"):A==="ai-vs-ai"?h=fe():console.error("Invalid game mode received",A)}});
