(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(o){if(o.ep)return;o.ep=!0;const n=t(o);fetch(o.href,n)}})();class W{boardPiece;label;constructor(e,t){this.boardPiece=e,this.label=t}}const w=10**9+7,O=-w;function z(s,e,t){return(s.x-e)*(s.x-e)<=t*t}function V(s){for(let e=0;e<r.COLUMNS;e++)if(z(s,3*r.PIECE_RADIUS*e+r.MASK_X_BEGIN+2*r.PIECE_RADIUS,r.PIECE_RADIUS))return e;return-1}function R(s){return s[Math.floor(Math.random()*s.length)]}function $(s){const e=[];for(let t=0;t<s.length;t++)e[t]=s[t].slice();return e}function T(s,e,t){const i=$(s);if(i[0][t]!==d.EMPTY||t<0||t>=r.COLUMNS)return{success:!1,map:i};let o=!1,n=0;for(let a=0;a<r.ROWS-1;a++)if(i[a+1][t]!==d.EMPTY){o=!0,n=a;break}return o||(n=r.ROWS-1),i[n][t]=e,{success:!0,map:i}}var d=(s=>(s.EMPTY=" ",s.PLAYER_1="ðŸ”´",s.PLAYER_2="ðŸ”µ",s.DRAW="D",s))(d||{});class r{static ROWS=6;static COLUMNS=7;static PLAYER_1_COLOR="#ef453b";static PLAYER_2_COLOR="#0059ff";static PIECE_STROKE_STYLE="black";static MASK_COLOR="#d8d8d8";static CANVAS_HEIGHT;static CANVAS_WIDTH;static PIECE_RADIUS;static MASK_X_BEGIN;static MASK_Y_BEGIN;static MESSAGE_WIDTH;static MESSAGE_X_BEGIN;static MESSAGE_Y_BEGIN;static SCALE;map;winnerBoardPiece;constructor(){this.map=[],this.winnerBoardPiece=" ",this.initConstants(),this.reset()}reset(){this.map=[];for(let e=0;e<r.ROWS;e++){this.map.push([]);for(let t=0;t<r.COLUMNS;t++)this.map[e].push(" ")}this.winnerBoardPiece=" "}initConstants(){r.CANVAS_HEIGHT=r.SCALE*480,r.CANVAS_WIDTH=r.SCALE*640,r.PIECE_RADIUS=r.SCALE*25,r.MASK_X_BEGIN=Math.max(0,r.CANVAS_WIDTH-(3*r.COLUMNS+1)*r.PIECE_RADIUS)/2,r.MASK_Y_BEGIN=Math.max(0,r.CANVAS_HEIGHT-(3*r.ROWS+1)*r.PIECE_RADIUS)/2,r.MESSAGE_WIDTH=r.SCALE*400,r.MESSAGE_X_BEGIN=(r.CANVAS_WIDTH-r.MESSAGE_WIDTH)/2,r.MESSAGE_Y_BEGIN=r.SCALE*20}async applyPlayerAction(e,t){const{success:i,map:o}=T(this.map,e.boardPiece,t);return this.map=o,i}debug(){console.log(this.map.map(e=>e.join(" ")).join(`
`))}getWinner(){if(this.winnerBoardPiece!==" ")return this.winnerBoardPiece;const e=[[0,-1],[0,1],[-1,-1],[-1,0],[-1,1],[1,-1],[1,0],[1,1]],t=(o,n,a,c,u)=>u>=4?!0:o<0||n<0||o>=r.ROWS||n>=r.COLUMNS||this.map[o][n]!==a?!1:t(o+c[0],n+c[1],a,c,u+1);let i=0;for(let o=0;o<r.ROWS;o++)for(let n=0;n<r.COLUMNS;n++){const a=this.map[o][n];if(a!==" "){for(let c=0;c<e.length;c++)if(t(o+e[c][0],n+e[c][1],a,e[c],1))return this.winnerBoardPiece=a}else i++}return i===0?this.winnerBoardPiece="D":" "}getPlayerColor(e){switch(e){case"ðŸ”´":return r.PLAYER_1_COLOR;case"ðŸ”µ":return r.PLAYER_2_COLOR;default:return"transparent"}}}class g extends W{static MAX_DEPTH=4;ownBoardPieceValue;enemyBoardPiece;constructor(e,t){super(e,t),this.ownBoardPieceValue=this.getBoardPieceValue(e),this.enemyBoardPiece=e===d.PLAYER_1?d.PLAYER_2:d.PLAYER_1}getBoardPieceValue(e){return e===d.EMPTY?0:e===this.boardPiece?1:-1}getStateValue(e){let t=d.EMPTY,i=0;for(let o=0;o<r.ROWS;o++)for(let n=0;n<r.COLUMNS;n++){let a=0,c=0,u=0,h=0;for(let l=0;l<=3;l++)n+l<r.COLUMNS&&(a+=this.getBoardPieceValue(e[o][n+l])),o+l<r.ROWS&&(c+=this.getBoardPieceValue(e[o+l][n])),o+l<r.ROWS&&n+l<r.COLUMNS&&(u+=this.getBoardPieceValue(e[o+l][n+l])),o-l>=0&&n+l<7&&(h+=this.getBoardPieceValue(e[o-l][n+l]));i+=a*a*a,i+=c*c*c,i+=u*u*u,i+=h*h*h,Math.abs(a)===4?t=a>0?this.boardPiece:this.enemyBoardPiece:Math.abs(c)===4?t=c>0?this.boardPiece:this.enemyBoardPiece:Math.abs(u)===4?t=u>0?this.boardPiece:this.enemyBoardPiece:Math.abs(h)===4&&(t=h>0?this.boardPiece:this.enemyBoardPiece)}return{winnerBoardPiece:t,chain:i}}transformValues(e,t,i){const o=t===this.boardPiece,n=t===this.enemyBoardPiece;return e-=i*i,o?e=w-100-i*i:n&&(e=O+100+i*i),e}getMove(e,t,i,o){const n=this.getStateValue(e),a=n.winnerBoardPiece===this.boardPiece,c=n.winnerBoardPiece===this.enemyBoardPiece;return t>=g.MAX_DEPTH||a||c?{value:this.transformValues(n.chain,n.winnerBoardPiece,t)*this.ownBoardPieceValue,move:-1}:t%2===0?this.minState(e,t+1,i,o):this.maxState(e,t+1,i,o)}maxState(e,t,i,o){let n=O,a=[];for(let c=0;c<r.COLUMNS;c++){const{success:u,map:h}=T(e,this.boardPiece,c);if(!u)continue;const{value:l}=this.getMove(h,t,i,o);if(l>n?(n=l,a=[c]):l===n&&a.push(c),n>o)return{value:n,move:R(a)};i=Math.max(i,n)}return{value:n,move:R(a)}}minState(e,t,i,o){let n=w,a=[];for(let c=0;c<r.COLUMNS;c++){const{success:u,map:h}=T(e,this.enemyBoardPiece,c);if(!u)continue;const{value:l}=this.getMove(h,t,i,o);if(l<n?(n=l,a=[c]):l===n&&a.push(c),n<i)return{value:n,move:R(a)};o=Math.min(o,n)}return{value:n,move:R(a)}}async getAction(e){const t=$(e.map),i=this.maxState(t,0,O,w);return console.log(`AI ${this.boardPiece} choose column ${i.move} with value of ${i.value}`),i.move}}class L extends W{clickPromiseResolver;constructor(e,t){super(e,t),this.clickPromiseResolver=null}doAction(e){this.clickPromiseResolver&&0<=e&&e<r.COLUMNS&&this.clickPromiseResolver(e)}getAction(e){return new Promise(t=>this.clickPromiseResolver=t)}}class U extends W{actionPromiseResolver;constructor(e,t){super(e,t),this.actionPromiseResolver=null}doAction(e){this.actionPromiseResolver&&0<=e&&e<r.COLUMNS&&this.actionPromiseResolver(e)}getAction(e){return new Promise(t=>this.actionPromiseResolver=t)}}class q{board;players;currentPlayerId;isMoveAllowed=!1;isGameWon=!1;isGameEnded=!1;constructor(e,t){this.board=t,this.players=e,this.currentPlayerId=0,this.reset()}reset(){this.isMoveAllowed=!1,this.isGameWon=!1,this.board.reset()}end(){this.reset(),this.isGameEnded=!0}async start(){for(this.isMoveAllowed=!0;!this.isGameWon;){if(this.isGameEnded)return;await this.move();const e=this.board.getWinner();if(e!==d.EMPTY){console.log("[GameBase] Game over: winner is player ",e),this.isGameWon=!0,this.isMoveAllowed=!1,this.announceWinner(e);break}}}async move(){if(this.isGameEnded||!this.isMoveAllowed)return;const e=this.players[this.currentPlayerId];let t=!1;for(;!t;){if(this.isGameEnded)return;this.waitingForMove();const i=await e.getAction(this.board);this.isMoveAllowed=!1,this.beforeMoveApplied(i),t=await this.board.applyPlayerAction(e,i),this.isMoveAllowed=!0,t?this.afterMove(i):console.log("Move not allowed! Try again.")}this.currentPlayerId=this.getNextPlayer()}announceWinner(e){const t={[d.DRAW]:"draw",[d.PLAYER_1]:"Player 1",[d.PLAYER_2]:"Player 2",[d.EMPTY]:"none"}[e];console.log("[GameBase] Game over: winner is ",t,e)}getNextPlayer(){return this.currentPlayerId===0?1:0}}var y=(s=>(s.NEW_PLAYER_CONNECTION_REQUEST="NEW_PLAYER_CONNECTION_REQUEST",s.NEW_PLAYER_CONNECTION_OK="NEW_PLAYER_CONNECTION_OK",s.NEW_MATCH_REQUEST="NEW_MATCH_REQUEST",s.NEW_MATCH_OK="NEW_MATCH_OK",s.GAME_READY="GAME_READY",s.GAME_ENDED="GAME_ENDED",s.GAME_RESET="GAME_RESET",s.CONNECT_MATCH_REQUEST="CONNECT_MATCH_REQUEST",s.CONNECT_MATCH_OK="CONNECT_MATCH_OK",s.CONNECT_MATCH_FAIL="CONNECT_MATCH_FAIL",s.HUNG_UP="HUNG_UP",s.OTHER_PLAYER_HUNGUP="OTHER_PLAYER_HUNGUP",s.MOVE_MAIN="MOVE_MAIN",s.MOVE_SHADOW="MOVE_SHADOW",s))(y||{});function _(s,e){return console.log("[ws] send: ",s,e),JSON.stringify({type:s,payload:e||{}})}function j(s){const e=JSON.parse(s);return console.log("[ws] receive: ",e),e}function J(){const s=[];let e=!1;function t(){e||(e=!0,window.requestAnimationFrame?window.requestAnimationFrame(i):setTimeout(i,66))}function i(){s.forEach(n=>{n()}),e=!1}function o(n){n&&s.push(n)}return{add:n=>{s.length||window.addEventListener("resize",t),o(n)}}}function H(s,{x:e=0,y:t=0,r:i=0,fillStyle:o="",strokeStyle:n=""}){s.save(),s.fillStyle=o,s.strokeStyle=n,s.beginPath(),s.arc(e,t,i,0,2*Math.PI,!1),s.fill(),s.restore()}function Z(s){const e=s.context;e.save(),e.fillStyle=f.MASK_COLOR,e.beginPath();const t=2*f.PIECE_RADIUS,i=3*f.PIECE_RADIUS;for(let o=0;o<f.ROWS;o++)for(let n=0;n<f.COLUMNS;n++)e.arc(i*n+f.MASK_X_BEGIN+t,i*o+f.MASK_Y_BEGIN+t,f.PIECE_RADIUS,0,2*Math.PI),e.rect(i*n+f.MASK_X_BEGIN+2*t,i*o+f.MASK_Y_BEGIN,-2*t,2*t);e.fill(),e.restore()}function x(s){s.context.clearRect(0,0,f.CANVAS_WIDTH,f.CANVAS_HEIGHT)}function N(){let s=null;const e=new Promise(t=>s=t);return s&&window.requestAnimationFrame(s),e}class f extends r{canvas;context;constructor(e){super(),this.canvas=e,this.context=e.getContext("2d"),this.getBoardScale(),this.initConstants(),this.reset(),this.onresize()}getBoardScale(){return window.innerWidth<640?r.SCALE=.5:r.SCALE=1}onresize(){let e=r.SCALE;J().add(()=>{this.getBoardScale(),e!==r.SCALE&&(e=r.SCALE,this.initConstants(),x(this),this.render())})}reset(){super.reset(),this.canvas&&(x(this),this.render())}initConstants(){if(super.initConstants(),this.canvas){const e=self.devicePixelRatio||1;this.canvas.width=f.CANVAS_WIDTH*e,this.canvas.height=f.CANVAS_HEIGHT*e,this.context.scale(e,e),this.canvas.style.width=f.CANVAS_WIDTH+"px",this.canvas.style.height=f.CANVAS_HEIGHT+"px"}}async animateAction(e,t,i){const o=this.getPlayerColor(i);let n=0;const a=async()=>{x(this),H(this.context,{x:3*r.PIECE_RADIUS*t+r.MASK_X_BEGIN+2*r.PIECE_RADIUS,y:n+r.MASK_Y_BEGIN+2*r.PIECE_RADIUS,r:r.PIECE_RADIUS,fillStyle:o,strokeStyle:r.PIECE_STROKE_STYLE}),this.render(),n+=r.PIECE_RADIUS};for(;e*3*r.PIECE_RADIUS>=n;)await N(),a()}render(){Z(this);for(let e=0;e<r.ROWS;e++)for(let t=0;t<r.COLUMNS;t++)H(this.context,{x:3*r.PIECE_RADIUS*t+r.MASK_X_BEGIN+2*r.PIECE_RADIUS,y:3*r.PIECE_RADIUS*e+r.MASK_Y_BEGIN+2*r.PIECE_RADIUS,r:r.PIECE_RADIUS,fillStyle:this.getPlayerColor(this.map[e][t]),strokeStyle:r.PIECE_STROKE_STYLE})}async applyPlayerAction(e,t){if(this.map[0][t]!==d.EMPTY||t<0||t>=r.COLUMNS)return!1;let i=!1,o=0;for(let n=0;n<r.ROWS-1;n++)if(this.map[n+1][t]!==d.EMPTY){i=!0,o=n;break}return i||(o=r.ROWS-1),await this.animateAction(o,t,e.boardPiece),this.map[o][t]=e.boardPiece,this.debug(),await N(),this.render(),!0}}function v(s=""){const e=document.querySelector(".message-body");if(!e){console.error(".message-body not found");return}const t=document.querySelector(".message-body-content");if(!t){console.error(".message-body-content not found");return}e.hasAttribute("open")&&e.close(),t.innerHTML=s,e.showModal()}const Y=document.querySelector(".statusbox"),S=document.querySelector(".statusbox-body-game"),ee=document.querySelector(".statusbox-body-connection"),M=document.querySelector(".statusbox-body-player");class D extends q{constructor(e,t){super(e,t)}beforeMoveApplied(){if(S){const e=this.players[this.currentPlayerId];S.textContent=`Dropping ${e.boardPiece} disc`}}waitingForMove(){if(!(!this.isMoveAllowed||this.isGameWon)&&(S&&(S.textContent="Wating for move"),M)){const e=this.players[this.currentPlayerId];M.textContent=`${e.label} ${e.boardPiece}`}}afterMove(){}announceWinner(e){if(super.announceWinner(e),e===d.EMPTY)return;let t,i="<h1>Thank you for playing.</h1>";e===d.DRAW?i+="It's a draw":(t=this.players.find(o=>o.boardPiece===e),t?i+=`${t.label} ${t.boardPiece} won`:i+=`Player ${e} won`),i+=".<br />After dismissing this message, click the board to reset game.",v(i),S&&(S.textContent="Game over"),M&&(M.textContent=e===d.DRAW?"It's a draw":t?`${t.label} ${t.boardPiece} won`:`Player ${e===d.PLAYER_1?"1 ðŸ”´":"2 ðŸ”µ"} won`)}}function K(s,e,t){const i=document.querySelector("canvas");if(!i){console.error("Canvas DOM is null");return}const o=new f(i),n=new s([e,t],o);Y?.classList.remove("hidden"),ee?.classList.add("hidden"),n.start(),S&&(S.textContent="Wating for move"),M&&(M.textContent=`${e.label} ${e.boardPiece}`);async function a(c){if(n.isGameWon)n.reset(),await N(),n.start();else{if(!i)return;const u=i.getBoundingClientRect(),h=c.clientX-u.left;c.clientY-u.top;const l=V({x:h});n.currentPlayerId===0?e.doAction(l):n.currentPlayerId===1&&t instanceof L&&t.doAction(l)}}return i.addEventListener("click",a),{end:()=>{n.end(),i.removeEventListener("click",a),Y?.classList.add("hidden")}}}class te extends D{}function ne(s,e){const t=new L(d.PLAYER_1,s),i=new L(d.PLAYER_2,e);return K(te,t,i)}class se extends D{}function ie(s){const e=new L(d.PLAYER_1,s),t=new g(d.PLAYER_2,"AI Player");return K(se,e,t)}const oe=document.querySelector(".statusbox");document.querySelector(".statusbox-body-game");const re=document.querySelector(".statusbox-body-connection");document.querySelector(".statusbox-body-player");class ae extends D{constructor(e,t){super(e,t)}announceWinner(e){super.announceWinner(e)}}function ce(){const s=document.querySelector("canvas");if(!s){console.error("Canvas DOM is null");return}const e=new f(s),t=new g(d.PLAYER_1,"AI Player 1"),i=new g(d.PLAYER_2,"AI Player 2"),o=new ae([t,i],e);oe?.classList.remove("hidden"),re?.classList.add("hidden"),o.start();async function n(a){o.isGameWon&&(o.reset(),await N(),o.start())}return s.addEventListener("click",n),{end:()=>{o.end(),s.removeEventListener("click",n)}}}var p=(s=>(s[s.FIRST=d.PLAYER_1]="FIRST",s[s.SECOND=d.PLAYER_2]="SECOND",s))(p||{});const k=document.querySelector(".statusbox"),C=document.querySelector(".statusbox-body-game"),b=document.querySelector(".statusbox-body-connection"),P=document.querySelector(".statusbox-body-player"),le="wss://c4-server.fly.dev/";class de extends q{connectionPlayerId=null;connectionMatchId=null;ws=null;gameMode;playerMain;playerShadow;constructor(e,t,{gameMode:i,playerName:o}){super(e,t),this.gameMode=i,i===p.FIRST?(this.playerMain=e[0],this.playerShadow=e[1]):(this.playerMain=e[1],this.playerShadow=e[0]),this.playerMain.label=o,this.initConnection()}end(){super.end(),this.endConnection()}endConnection(){this.ws&&this.ws.close()}initConnection(){console.log("initConnection"),this.connectionPlayerId=null,this.connectionMatchId=null,this.ws&&this.ws.close();const e=()=>{this.isMoveAllowed=!1,b&&(b.textContent="Disconnected from server"),C&&(C.textContent="Game over"),P&&(P.textContent="Disconnected from match")};this.ws=new WebSocket(le),this.ws.addEventListener("message",t=>{this.messageActionHandler(j(t.data))}),this.ws.addEventListener("open",()=>{this.ws&&this.ws.send(_(y.NEW_PLAYER_CONNECTION_REQUEST,{playerName:this.playerMain.label})),b&&(b.textContent="Connected to server"),C&&(C.textContent=""),P&&(P.textContent="")}),this.ws.addEventListener("close",t=>{console.log("[ws] close event",t),e()}),this.ws.addEventListener("error",t=>{console.log("[ws] error event",t),e()})}initMatch=()=>{this.ws&&this.ws.send(_(y.NEW_MATCH_REQUEST,{playerId:this.connectionPlayerId}))};connectToMatch=e=>{this.ws&&this.ws.send(_(y.CONNECT_MATCH_REQUEST,{playerId:this.connectionPlayerId,matchId:e}))};messageActionHandler=e=>{switch(e.type){case y.NEW_PLAYER_CONNECTION_OK:if(this.connectionPlayerId=e.payload.playerId,this.gameMode===p.FIRST)this.initMatch();else if(this.gameMode===p.SECOND){const i=new URLSearchParams(location.search).get("matchId");if(!i)return;this.connectToMatch(i)}break;case y.NEW_MATCH_OK:{this.connectionMatchId=e.payload.matchId;const t=`${location.href}?matchId=${this.connectionMatchId}`;console.log("[url] Share this",t),v(`<h1>Share this URL</h1><p>Please share this URL to your friend to start the game: <input type="text" id="copy-box" class="copy-box" readonly value="${t}" /><button type="button" id="copy-button">Copy</button></p>`);const i=document.getElementById("copy-box");i.focus(),i.select(),document.getElementById("copy-button")?.addEventListener("click",async()=>{let o=!1;if(navigator.clipboard)try{await navigator.clipboard.writeText(t),console.log("Using Clipboard API to write share url into clipboard"),o=!0}catch{}o||(i?.select(),i?.setSelectionRange(0,99999),document.execCommand("copy"),console.log("Using fallback method to write share url into clipboard"))})}break;case y.CONNECT_MATCH_OK:this.connectionMatchId=e.payload.matchId;break;case y.CONNECT_MATCH_FAIL:v("<h1>Error</h1> Failed to connect to match."),b&&(b.textContent="Connection error");break;case y.GAME_READY:{if(this.playerShadow.label=e.payload.otherPlayerName,v(`<h1>Game started</h1> The first piece should be dropped by ${this.isCurrentMoveByCurrentPlayer()?"you":"the other player"}`),C&&(C.textContent="Wating for move"),P){const t=this.players[this.currentPlayerId];P.textContent=`${t.label} ${t.boardPiece} `+(this.isCurrentMoveByCurrentPlayer()?"(you)":"(the other player)")}this.start()}break;case y.MOVE_SHADOW:this.playerShadow.doAction(e.payload.column);break;case y.GAME_ENDED:{const{winnerBoardPiece:t}=e.payload;let i=this.players.find(n=>n.boardPiece===t);const o=t===d.DRAW?"It's a draw":i?`${i.label} ${i.boardPiece} won`:`Player ${t===d.PLAYER_1?"1 ðŸ”´":"2 ðŸ”µ"} won`;v("<h1>Thank you for playing</h1>"+o+"<br />Next game will be started in 10 seconds."),C&&(C.textContent="Game over"),P&&(P.textContent=o)}break;case y.GAME_RESET:this.reset();break;case y.OTHER_PLAYER_HUNGUP:v("<h1>Other player disconnected</h1> Please reload the page to start a new match");break}};isCurrentMoveByCurrentPlayer(){return this.gameMode===p.FIRST?this.currentPlayerId===0:this.currentPlayerId===1}beforeMoveApplied=()=>{if(C){const e=this.players[this.currentPlayerId];C.textContent=`Dropping ${e.boardPiece} disc`}};waitingForMove=()=>{if(C&&(C.textContent="Wating for move"),P){const e=this.players[this.currentPlayerId];P.textContent=`${e.label} ${e.boardPiece} `+(this.isCurrentMoveByCurrentPlayer()?"(you)":"(the other player)")}};afterMove=e=>{this.ws&&this.isCurrentMoveByCurrentPlayer()&&this.ws.send(_(y.MOVE_MAIN,{playerId:this.connectionPlayerId,matchId:this.connectionMatchId,column:e}))};announceWinner(e){super.announceWinner(e)}}function ue(s){const e=document.querySelector("canvas");if(!e){console.error("Canvas DOM is null");return}const o=new URLSearchParams(location.search).get("matchId")?p.SECOND:p.FIRST,n=new f(e),a=o===p.FIRST?[new L(d.PLAYER_1,s),new U(d.PLAYER_2,"Other player")]:[new U(d.PLAYER_1,"Other player"),new L(d.PLAYER_2,s)],c=new de(a,n,{gameMode:o,playerName:s});k?.classList.remove("hidden"),b?.classList.remove("hidden");async function u(h){if(!c.isGameWon){if(!e)return;const l=e.getBoundingClientRect(),A=h.clientX-l.left;h.clientY-l.top;const I=V({x:A});c.playerMain.doAction(I)}}return e.addEventListener("click",u),{end:()=>{c.end(),e.removeEventListener("click",u),k?.classList.add("hidden")}}}document.addEventListener("DOMContentLoaded",()=>{const s=document.querySelector(".section-canvas");if(!s){console.error("Canvas element not found");return}const e=document.querySelector(".init-screen");if(!e){console.error("Mode element not found ");return}new f(s).render();const o=new URLSearchParams(location.search).get("matchId"),n=document.querySelector(".statusbox-button-back"),a=document.querySelector(".game-settings-form");if(!a){console.error(".game-settings-form not found ");return}const c=a.querySelector(".game-settings-player-1-name-label"),u=a.querySelector(".game-settings-player-2-name-label"),h=a.querySelector(".game-settings-player-1-name-input"),l=a.querySelector(".game-settings-player-2-name-input");let A=null;n?.classList.add("hidden"),e.showModal();let I=o?"online-human":"offline-ai";G(),n?.addEventListener("click",()=>{A&&A.end&&A.end(),n?.classList.add("hidden"),e.showModal()}),e.addEventListener("cancel",E=>{E.preventDefault()}),e.addEventListener("close",E=>{const m=new FormData(a),X=m.get("mode"),Q=m.get("player-1-name"),B=m.get("player-2-name");F(X,[Q,B])}),a.addEventListener("input",E=>{I=new FormData(a).get("mode"),G()});function G(){if(o){for(let E of a.querySelectorAll(".game-settings-mode-input")){const m=E;m.readOnly=!0,m.value==="online-human"?m.checked=!0:m.checked=!1}u.textContent="Your name:",h.disabled=!0,l.disabled=!1,c.classList.add("hidden"),h.classList.add("hidden"),u.classList.remove("hidden"),l.classList.remove("hidden")}else I==="offline-human"?(c.textContent="First player's name:",u.textContent="Second player's name:",c.classList.remove("hidden"),h.classList.remove("hidden"),u.classList.remove("hidden"),l.classList.remove("hidden"),h.disabled=!1,l.disabled=!1):I==="offline-ai"?(c.textContent="Player's name:",u.textContent="Player's name:",c.classList.remove("hidden"),h.classList.remove("hidden"),u.classList.add("hidden"),l.classList.add("hidden"),h.disabled=!1,l.disabled=!0):I==="online-human"?(c.textContent="Your name:",u.textContent="Other player's name:",c.classList.remove("hidden"),h.classList.remove("hidden"),u.classList.add("hidden"),l.classList.add("hidden"),h.disabled=!1,l.disabled=!0):I==="ai-vs-ai"&&(c.textContent="Player's name:",u.textContent="Player's name:",c.classList.add("hidden"),h.classList.add("hidden"),u.classList.add("hidden"),l.classList.add("hidden"),h.disabled=!0,l.disabled=!0)}function F(E,m){console.log("initGame chosenMode:",E),n?.classList.remove("hidden"),E==="offline-human"?A=ne(m[0]||"Player 1",m[1]||"Player 2"):E==="offline-ai"?A=ie(m[0]||"Player 1"):E==="online-human"?A=ue(o?m[1]||"Player 2":m[0]||"Player 1"):E==="ai-vs-ai"?A=ce():console.error("Invalid game mode received",E)}});
